# üîí –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ HTTPS –¥–ª—è FamilyWay +

## üöÄ –ë—ã—Å—Ç—Ä–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

### 1. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Å–∫—Ä–∏–ø—Ç
sudo ./setup_ssl.sh
```

### 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ HTTPS
./check_https_security.sh
```

## üìã –ß—Ç–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ

### Django –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ (settings_production.py):
- ‚úÖ `SECURE_SSL_REDIRECT = True` - –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–π —Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ HTTPS
- ‚úÖ `SESSION_COOKIE_SECURE = True` - –±–µ–∑–æ–ø–∞—Å–Ω—ã–µ cookies
- ‚úÖ `CSRF_COOKIE_SECURE = True` - –±–µ–∑–æ–ø–∞—Å–Ω—ã–µ CSRF —Ç–æ–∫–µ–Ω—ã
- ‚úÖ `SECURE_HSTS_SECONDS = 31536000` - HSTS –Ω–∞ 1 –≥–æ–¥
- ‚úÖ `SECURE_HSTS_INCLUDE_SUBDOMAINS = True` - HSTS –¥–ª—è –ø–æ–¥–¥–æ–º–µ–Ω–æ–≤
- ‚úÖ `SECURE_HSTS_PRELOAD = True` - –ø—Ä–µ–¥–∑–∞–≥—Ä—É–∑–∫–∞ HSTS

### Nginx –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:
- ‚úÖ HTTP ‚Üí HTTPS —Ä–µ–¥–∏—Ä–µ–∫—Ç (301)
- ‚úÖ SSL/TLS 1.2 –∏ 1.3
- ‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω—ã–µ SSL —à–∏—Ñ—Ä—ã
- ‚úÖ SSL stapling
- ‚úÖ –ó–∞–≥–æ–ª–æ–≤–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏:
  - `Strict-Transport-Security`
  - `X-Frame-Options: DENY`
  - `X-Content-Type-Options: nosniff`
  - `X-XSS-Protection`
  - `Content-Security-Policy`
  - `Permissions-Policy`

### –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å —Ñ–∞–π–ª–æ–≤:
- ‚úÖ –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ `.env`, `.log`, `.sql` —Ñ–∞–π–ª–∞–º
- ‚úÖ –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ backup —Ñ–∞–π–ª–æ–≤
- ‚úÖ –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –≤–µ—Ä—Å–∏–æ–Ω–Ω–æ–≥–æ –∫–æ–Ω—Ç—Ä–æ–ª—è (`.git`, `.svn`)

## üîß –†—É—á–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

### 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Certbot
```bash
sudo apt update
sudo apt install -y certbot python3-certbot-nginx
```

### 2. –ü–æ–ª—É—á–µ–Ω–∏–µ SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞
```bash
sudo certbot --nginx -d familyway.plus -d www.familyway.plus
```

### 3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
```bash
# –î–æ–±–∞–≤–∏—Ç—å –≤ crontab
echo "0 12 * * * /usr/bin/certbot renew --quiet --post-hook 'systemctl reload nginx'" | sudo crontab -
```

### 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
```bash
sudo nginx -t
sudo systemctl reload nginx
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–¥–∏—Ä–µ–∫—Ç–æ–≤
```bash
# HTTP –¥–æ–ª–∂–µ–Ω —Ä–µ–¥–∏—Ä–µ–∫—Ç–∏—Ç—å –Ω–∞ HTTPS
curl -I http://familyway.plus
curl -I http://www.familyway.plus
```

### 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ HTTPS
```bash
# HTTPS –¥–æ–ª–∂–µ–Ω —Ä–∞–±–æ—Ç–∞—Ç—å
curl -I https://familyway.plus
curl -I https://www.familyway.plus
```

### 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
- –û—Ç–∫—Ä–æ–π—Ç–µ https://www.ssllabs.com/ssltest/
- –í–≤–µ–¥–∏—Ç–µ –≤–∞—à –¥–æ–º–µ–Ω: `familyway.plus`
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –æ—Ü–µ–Ω–∫—É –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

## üö® –í–∞–∂–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã

### –ü–µ—Ä–µ–¥ –Ω–∞—Å—Ç—Ä–æ–π–∫–æ–π HTTPS:
1. ‚úÖ –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –¥–æ–º–µ–Ω —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ –≤–∞—à —Å–µ—Ä–≤–µ—Ä
2. ‚úÖ –û—Ç–∫—Ä–æ–π—Ç–µ –ø–æ—Ä—Ç—ã 80 –∏ 443 –≤ —Ñ–∞–π—Ä–≤–æ–ª–µ
3. ‚úÖ –û—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –¥—Ä—É–≥–∏–µ –≤–µ–±-—Å–µ—Ä–≤–µ—Ä—ã –Ω–∞ –ø–æ—Ä—Ç–∞—Ö 80/443

### –ü–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ HTTPS:
1. ‚úÖ –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–±–æ—Ç—É —Å–∞–π—Ç–∞ –≤ –±—Ä–∞—É–∑–µ—Ä–µ
2. ‚úÖ –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ Django –∏—Å–ø–æ–ª—å–∑—É–µ—Ç HTTPS –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
3. ‚úÖ –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏: `tail -f /var/log/nginx/error.log`

## üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º

### –ü—Ä–æ–±–ª–µ–º–∞: "SSL certificate not found"
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã
sudo certbot certificates

# –û–±–Ω–æ–≤–∏—Ç–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç
sudo certbot renew --force-renewal
```

### –ü—Ä–æ–±–ª–µ–º–∞: "Nginx configuration error"
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å
sudo nginx -t

# –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
sudo systemctl reload nginx
```

### –ü—Ä–æ–±–ª–µ–º–∞: "Django not using HTTPS"
```bash
# –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ production –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
export DJANGO_SETTINGS_MODULE=baybyway.settings_production
python manage.py runserver
```

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏: `sudo journalctl -u nginx -f`
2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É: `./check_https_security.sh`
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤: `sudo certbot certificates`

---

**üéâ –ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! FamilyWay + —Ç–µ–ø–µ—Ä—å —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å—é HTTPS!**
